# Инфраструктура ClickHouse

## Требования

- Docker и Docker Compose
- DBMate
- Make (опционально, для использования команд из Makefile)

## Структура

```
Infrastructure-ClickHouse/
├── Dockerfile                  # Конфигурация Docker-образа сервера ClickHouse
├── docker-compose.yml          # Определение сервиса Docker Compose
├── Makefile                    # Команды для управления инфраструктурой
├── .env.example                # Пример переменных окружения
└── migrations/                 # Миграции базы данных
    ├── schema.sql              # Текущая схема базы данных
    └── versions/               # Отдельные файлы миграций
```

## Схема базы данных

База данных включает следующие таблицы:

1. **content_event** - Хранит события, связанные с контентом:
    - `event_id` (UUID)
    - `user_id` (String)
    - `ts` (DateTime)
    - `content` (String)

2. **topic_event** - Хранит события анализа тематик:
    - `event_id` (UUID)
    - `user_id` (String)
    - `ts` (DateTime)
    - `sentiment` (Кортеж из положительных, отрицательных и нейтральных оценок)
    - `topics` (Массивы имен и весов)
    - `entities` (Массивы категорий, имен и весов)

## Инструкции по настройке

### Конфигурация

1. Скопируйте пример файла окружения и настройте его по необходимости:

```
cp .env.example .env
```

2. Настройте следующие переменные окружения в файле `.env`

### Запуск инфраструктуры

```
make up
```

### Выполнение миграций

```
make migrate
```

```
make status
```

### Остановка инфраструктуры

Остановить и удалить контейнеры и тома:

```
make down
```
